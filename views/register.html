<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Register</title>
    <link rel="stylesheet" href="/static/css/register.css">
    <script src="../static/js/jquery-3.3.1.min.js"></script>
    <script src="../static/js/jquery.url.js"></script>
    <script>
        //检验输入是否合法
        $(document).ready(function () {
            //1、获取表单元素   --> 通过name操作表单里面的具体元素
            $("#form").validate({ //这个就是验证合法性
                //2、指定要验证的内容
                rules: {
                    //验证用户名和密码
                    username: {
                        required: true, //非空验证
                        rangelength: [4, 12] //长度范围验证
                    },
                    password: {
                        required: true,
                        rangelength: [6, 20]
                    },
                    repassword: {
                        required: true,
                        rangelength: [6, 20],
                        //判断两次密码是否一致，通过id
                        equalTo: "#password"
                    },
                    email:{
                        required: true,
                        rangelength: [8, 20],
                    }
                },
                //3、指定验证未通过时显示的错误信息
                messages: {  //注意：这个messages不加就是显示的英文
                    username: {
                        required: "用户名不能为空",
                        rangelength: "用户名长度必须在4~12之间"
                    },
                    password: {
                        required: "密码不能为空",
                        rangelength: "密码长度必须在6~20之间"
                    },
                    repassword: {
                        required: "确认密码不能为空",
                        rangelength: "确认密码长度必须在6~20之间",
                        equalTo: "输入的密码两次不一致"
                    },
                    email:{
                        required: "邮箱不能为空",
                        rangelength: "邮箱长度必须在8~20之间",
                    }
                },
            })
        });
        function checkName() {
            /*获取 = Username 的值*/
            var username = document.getElementById("userName").value;
            /*定义一个json对象，因为怕存在跨域问题*/
            var userName = {
                "username":username,
            };
            $.ajax({
                url:"/isRegister",//请求的地址
                type:"POST",
                /*dataType:数据格式 有xml,json,html...*/
                dataType:"json",
                /*把数据序列化发送*/
                data:JSON.stringify(userName),
                /*内容类型*/
                contentType:"application/json;charset=utf8",
                success:function (msg) {
                    /*回传的参数*/
                    console.log(msg);
                    if(msg === "true"){//已经存在
                        $("#msg").css("color","red");
                        $("#msg").html("用户名已经存在")
                        $("#submit").attr("disabled",true)
                        $("#submit").css("color","#ccc")

                    }else if(msg === "false"){//不存在
                        $("#msg").css("color","green");
                        $("#msg").html(" ")
                    }
                },
            })
        }
    </script>
</head>
<body>
<form id="form" method="post" action="/register">
    <div class="regist">
        <div class="regist_center">
            <div class="regist_top">
                <div class="left fl">会员注册</div>
                <div class="right fr"><a href="/" target="_self">度生活</a></div>
                <div class="clear"></div>
                <div class="xian center"></div>
            </div>
            <div class="regist_main center">
                <div class="username">
                    用&nbsp;&nbsp;户&nbsp;&nbsp;名:&nbsp;&nbsp; <input class="shurukuang" type="text" id="userName" name="username" placeholder="请输入你的用户名[至少4位]" onblur="checkName()"/>
                    <!--Ajax验证是否已经存在 -->
                    <span id = "msg"></span><br>
                </div>
                <div class="username">
                    密&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;码:&nbsp;&nbsp; <input class="shurukuang" type="password" id="password" name="password" placeholder="请输入你的密码[6-20位]"/>
                </div>
                <div class="username">
                    确认密码:&nbsp;&nbsp;<input class="shurukuang" type="password" name="repassword" placeholder="请确认你的密码" id="mm2"/>
                </div>
                <div class="username">邮&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;箱:&nbsp;&nbsp;<input class="shurukuang" id="email" type="text" name="email" placeholder="请填写邮箱地址"/>
                </div>
                <!-- <div class="username">
                    <div class="left fl">验&nbsp;&nbsp;证&nbsp;&nbsp;码:&nbsp;&nbsp;<input class="yanzhengma" type="text" name="username" placeholder="请输入验证码"/></div>
                    <div class="right fl"><img src="./image/yanzhengma.jpg"></div>
                    <div class="clear"></div>
                </div> -->
            </div>
            <div class="regist_submit">
                <input class="submit" type="submit" name="submit" id="submit" value="立即注册">
            </div>
        </div>
    </div>
</form>
</body>
</html>